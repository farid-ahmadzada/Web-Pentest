# What is Authentication
- Authentication is the process of verifying the identity of a user or client. Websites are potentially exposed to anyone who is connected to the internet. This makes robust authentication mechanisms integral to effective web security.
- There are three main types of authentication:
    - Something you know, such as a password or the answer to a security question. These are sometimes called "knowledge factors".
    - Something you have, This is a physical object such as a mobile phone or security token. These are sometimes called "possession factors".
    - Something you are or do. For example, your biometrics or patterns of behavior. These are sometimes called "inherence factors".

## Difference between authentication and authorization
- Authentication is the process of verifying that a user is who they claim to be. Authorization involves verifying whether a user is allowed to do something.
- Authentication user:pass login
- Authorization your permission, access, rights

## Auth Vulnerabilities Occur :
- Fail to adequately protect against brute-force attacks.
- Logic flaws or poor coding in the implementation allow the authentication mechanisms to be bypassed entirely by an attacker. This is sometimes called "broken authentication".

# Vulnerabilities in password-based login

## While Brute-F ing 
- Pay Attention
    - **Status Codes:**
    - **Error messages:**
    - **Response times:**

## Bypass **IP-based brute-force protection** by manipulating HTTP request headers.
```
HTTP ...
...
X-Forwarded-For $change-number-every-request$
...
```
## Flawed brute-force protection
- Common ways to protect BF
    - Locking the account that the remote user is trying to access if they make too many failed login attempts
    - Blocking the remote user's IP address if they make too many login attempts in quick succession

 - **In some implementations, the counter for the number of failed attempts resets if the IP owner logs in successfully.*

## Account Locking
- 1. Try Unregistered User : alice 100 time with diff pass -> "Incorrext password or User"
  2. Try Registered User : bob 100 time with diff pass -> "You have made too many incorrect login attempts."
- In this way you can identify some usernames

## User Rate Limiting
- IP unblocked ways
    - Automatically after a certain period of time
    - Manually by an administrator
    - Manually by the user after successfully completing a CAPTCHA
 



# Vulnerabilities in multi-factor authentication
- Verifying biometric factors is impractical for most websites. However, it is increasingly common to see both mandatory and optional two-factor authentication (2FA) based on something you know and something you have.
- The full benefits of multi-factor authentication are only achieved by verifying multiple different factors. Verifying the same factor in two different ways is not true two-factor authentication. **Email-based 2FA is one such example.**

  ## Bypassing two-factor authentication
- If the user is first prompted to enter a password, and then prompted to enter a verification code on a separate page, the user is effectively in a "logged in" state before they have entered the verification code. In this case, it is worth testing to see if you can directly skip to "logged-in only" pages after completing the first authentication step. Occasionally, you will find that a website doesn't actually check whether or not you completed the second step before loading the page.

  1. LAB 1 Basic 2FA: Manually change the URL to navigate to /my-account From without prompt Key. The lab is solved when the page loads.
  2. LAB 2 Flawed two-factor verification logic:
             ```
             With Burp running, log in to your own account and investigate the 2FA verification process. Notice that in the POST /login2 request, the verify parameter is used to determine which user's account is being accessed.
            Log out of your account.
            Send the GET /login2 request to Burp Repeater. Change the value of the verify parameter to carlos and send the request. This ensures that a temporary 2FA code is generated for Carlos.
            Go to the login page and enter your username and password. Then, submit an invalid 2FA code.
            Send the POST /login2 request to Burp Intruder.
            In Burp Intruder, set the verify parameter to carlos and add a payload position to the mfa-code parameter. Brute-force the verification code.
            Load the 302 response in the browser.
            Click My account to solve the lab.
             ```



# Vulnerabilities in other authentication mechanisms

## Keeping users logged in
- This functionality is often implemented by generating a "remember me" token of some kind, which is then stored in a persistent cookie.
- Some websites assume that if the cookie is encrypted in some way it will not be guessable even if it does use static values. While this may be true if done correctly, naively "encrypting" the cookie using a simple
- LAB1: We found formula of stay-logged-in cookie , BASE64[username + ":" MD5(passwors)] , then brute force it 
          ```
          ...
          Cookie: session=QJFDY08nTTocmV3ZD1PoTUUxcVmOk8wa; stay-logged-in=Y2FybG9zOjkzMjc5ZTMzMDhiZGJiZWVkOTQ2ZmM5NjUwMTdmNjdh
          ...
          ```

## Resetting Password (via EMAIL and URL)
- Basic way :```http://vulnerable-website.com/reset-password?user=victim-user```
- High Entropy ```http://vulnerable-website.com/reset-password?token=a0ba0d1cb3b63d13822572fcff1a241895d893f659164d4cc550b421ebdd48a8```
- What happen? Token go backend and test token valid or not. But some implementations backend can't validate token properly
- LAB1 : Server cant validate token properly, We take URL from wiener email, then change URL request to user carlos and get carlos password-reset page
        ```

  POST /forgot-password?temp-forgot-password-token=pb3pp2p66rmup10lzmmfxqjisvqxa3z5 HTTP/2
   . . . 

  temp-forgot-password-token=pb3pp2p66rmup10lzmmfxqjisvqxa3z5&username=wiener&new-password-1=^TARGET-USERNAME^&new-password-2=peter1
        ```

